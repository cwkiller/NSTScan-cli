# -*- coding: utf-8 -*-

"""
Copyright (c) 2017 hualala Security (https://www.hualala.com)
author wenzhaowei[at]hualala.com
"""
import sys
sys.path.append('./thirdparty/Pocsuite')
from thirdparty.Pocsuite.pocsuite.api.cannon import Cannon
from core.colorlog import info as log,error


def runPlugins(task_queue,result_queue):
    while not task_queue.empty():
        # ['http://m.hualala.com/', 'pocs\\dedecms_re.py']
        url, poc =  task_queue.get()
        try:
            info = {
                "pocname":poc[14:-3],
                "pocstring" : open("./"+poc).read(),
                "mode":"verify"
            }
            invoker = Cannon(url, info).run()
            log("url [%s] verify [%s] is [%s] " % (invoker[0],invoker[1],invoker[5][1]))
            result_queue.put(invoker)
        except IOError as identifier:
            error('poc plugins not find , check your options')
        
        




